<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="google-site-verification" content="HjCDXQDYGTp90NJMDiU2lbcUwyx6JTOxQAV_wB0aVso" />
    <title>Maven And The Classpath</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- Le styles -->
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="../assets/css/asciidoctor.css" rel="stylesheet">
    <link href="../assets/css/base.css" rel="stylesheet">
    <link href="../assets/css/prettify.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../favicon.ico">
  </head>
  <body onload="prettyPrint()">
    <div id="wrap">

	<!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../">GR</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../about.html">About</a></li>
            <li><a href="../feed.xml">Subscribe</a></li>
		<!--
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="#">Action</a></li>
                <li><a href="#">Another action</a></li>
                <li><a href="#">Something else here</a></li>
                <li class="divider"></li>
                <li class="dropdown-header">Nav header</li>
                <li><a href="#">Separated link</a></li>
                <li><a href="#">One more separated link</a></li>
              </ul>
            </li>
		-->
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    <div class="container">

	<div class="page-header">
		<h1>Maven And The Classpath</h1>
	</div>

	<p><em>22 November 2020</em></p>

	<div class="dlist">
   <dl>
    <dt class="hdlist1">
     	Summary
    </dt>
    <dd>
			<p>When Maven's Surefire plugin executes unit tests of a project, developers do not need to provide the classpath containing all dependencies. Instead, Maven sets up the required classpath. Other plugins utilize the Maven generated classpath, too. This Blog post is about some of the usages of the Maven classpath.</p>
    </dd>
   </dl>
  </div>

	<p><div class="sect1"> 
 <h2 id="_maven_dependency_plugin">Maven Dependency Plugin</h2> 
 <div class="sectionbody"> 
  <div class="paragraph"> 
   <p>Have you ever wondered how the Maven setup classpath for test execution by Surefire looks like?</p> 
  </div> 
  <div class="paragraph"> 
   <p>Let’s start with an example. Given the sample project with the following dependencies, we’ll explore the setup of the classpath generated by Maven in detail:</p> 
  </div> 
  <div class="listingblock"> 
   <div class="content"> 
    <pre class="highlightjs highlight"><code>$ mvn dependency:tree
[INFO] Scanning for projects...
[INFO]
[INFO] ---------------------&lt; net.gunther.cli:json2yaml &gt;----------------------
[INFO] Building json2yaml 0.0.1-SNAPSHOT
[INFO] --------------------------------[ jar ]---------------------------------
[INFO]
[INFO] --- maven-dependency-plugin:2.8:tree (default-cli) @ json2yaml ---
[INFO] net.gunther.cli:json2yaml:jar:0.0.1-SNAPSHOT
[INFO] +- javax.json:javax.json-api:jar:1.1:compile
[INFO] +- org.glassfish:javax.json:jar:1.1:compile
[INFO] \- org.junit.jupiter:junit-jupiter:jar:5.7.0:test
[INFO]    +- org.junit.jupiter:junit-jupiter-api:jar:5.7.0:test
[INFO]    |  +- org.apiguardian:apiguardian-api:jar:1.1.0:test
[INFO]    |  +- org.opentest4j:opentest4j:jar:1.2.0:test
[INFO]    |  \- org.junit.platform:junit-platform-commons:jar:1.7.0:test
[INFO]    +- org.junit.jupiter:junit-jupiter-params:jar:5.7.0:test
[INFO]    \- org.junit.jupiter:junit-jupiter-engine:jar:5.7.0:test
[INFO]       \- org.junit.platform:junit-platform-engine:jar:1.7.0:test
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
...</code></pre> 
   </div> 
  </div> 
  <div class="paragraph"> 
   <p>The sample projects depends on the JSON-P API and its reference implementation by Glassfish. In addition, a dependency on the JUnit 5 test framework is defined. The sample project is my playground to get familiar with JSON-P functionality.</p> 
  </div> 
  <div class="paragraph"> 
   <p>The Maven Dependency plugin provides the simplest way to display the classpath:</p> 
  </div> 
  <div class="listingblock"> 
   <div class="content"> 
    <pre class="highlightjs highlight"><code>$ mvn dependency:build-classpath
[INFO] Scanning for projects...
[INFO]
[INFO] ---------------------&lt; net.gunther.cli:json2yaml &gt;----------------------
[INFO] Building json2yaml 0.0.1-SNAPSHOT
[INFO] --------------------------------[ jar ]---------------------------------
[INFO]
[INFO] --- maven-dependency-plugin:2.8:build-classpath (default-cli) @ json2yaml ---
[INFO] Dependencies classpath:
/home/gunther/.m2/repository/javax/json/javax.json-api/1.1/javax.json-api-1.1.jar:/home/gunther/.m2/repository/org/glassfish/javax.json/1.1/javax.json-1.1.jar:/home/gunther/.m2/repository/org/junit/jupiter/junit-jupiter/5.7.0/junit-jupiter-5.7.0.jar:/home/gunther/.m2/repository/org/junit/jupiter/junit-jupiter-api/5.7.0/junit-jupiter-api-5.7.0.jar:/home/gunther/.m2/repository/org/apiguardian/apiguardian-api/1.1.0/apiguardian-api-1.1.0.jar:/home/gunther/.m2/repository/org/opentest4j/opentest4j/1.2.0/opentest4j-1.2.0.jar:/home/gunther/.m2/repository/org/junit/platform/junit-platform-commons/1.7.0/junit-platform-commons-1.7.0.jar:/home/gunther/.m2/repository/org/junit/jupiter/junit-jupiter-params/5.7.0/junit-jupiter-params-5.7.0.jar:/home/gunther/.m2/repository/org/junit/jupiter/junit-jupiter-engine/5.7.0/junit-jupiter-engine-5.7.0.jar:/home/gunther/.m2/repository/org/junit/platform/junit-platform-engine/1.7.0/junit-platform-engine-1.7.0.jar
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
...</code></pre> 
   </div> 
  </div> 
  <div class="paragraph"> 
   <p>Maven creates this classpath by considering the project’s dependencies. The reported classpath consists of references to JAR files cached in local Maven repository. Even the JAR artifact of the project is referenced from local Maven cache and not from the <code>/target</code> directory one or the other might expect. This means that at least Maven’s <code>install</code> lifecycle has to be executed before the dependency plugin is able to build the classpath correctly.</p> 
  </div> 
  <div class="paragraph"> 
   <p>Please note, that transitive dependencies are included in the generated classpath, too.</p> 
  </div> 
  <div class="paragraph"> 
   <p>Interestingly, the <code>dependency:build-classpath</code> gives the <em>test classpath</em>, ie. it also includes dependencies of scope <code>test</code> and <code>provided</code>. If you would like to know the classpath required for running the project’s application, the <code>includeScope</code> option has to be set as System property like follows:</p> 
  </div> 
  <div class="listingblock"> 
   <div class="content"> 
    <pre class="highlightjs highlight"><code>$ mvn dependency:build-classpath -DincludeScope=compile
[INFO] Scanning for projects...
[INFO]
[INFO] ---------------------&lt; net.gunther.cli:json2yaml &gt;----------------------
[INFO] Building json2yaml 0.0.1-SNAPSHOT
[INFO] --------------------------------[ jar ]---------------------------------
[INFO]
[INFO] --- maven-dependency-plugin:2.8:build-classpath (default-cli) @ json2yaml ---
[INFO] Dependencies classpath:
/home/gunther/.m2/repository/org/glassfish/javax.json/1.1/javax.json-1.1.jar:/home/gunther/.m2/repository/javax/json/javax.json-api/1.1/javax.json-api-1.1.jar
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
...</code></pre> 
   </div> 
  </div> 
 </div> 
</div> 
<div class="sect1"> 
 <h2 id="_maven_exec_plugin">Maven Exec Plugin</h2> 
 <div class="sectionbody"> 
  <div class="paragraph"> 
   <p>The Maven’s exec plugin also makes a lot of use of the generated classpath. Because the exec plugin allows to execute the project’s application as defined by the POM, it’s not surprising that the required classpath is taken from Maven.</p> 
  </div> 
  <div class="paragraph"> 
   <p>In the following, the <code>exec</code> goal of the plugin is used. Even if the <code>java</code> goal is sufficient to execute Java application, the <code>exec</code> is sometimes beneficial because of:</p> 
  </div> 
  <div class="ulist"> 
   <ul> 
    <li> <p>Allows to execute non-Java applications</p> </li> 
    <li> <p>Executes Java applications in its own JVM</p> </li> 
   </ul> 
  </div> 
  <div class="paragraph"> 
   <p>The exec plugin provides another way to display the Maven generated classpath:</p> 
  </div> 
  <div class="listingblock"> 
   <div class="content"> 
    <pre class="highlightjs highlight"><code>$ mvn exec:exec -Dexec.executable=echo -Dexec.args="%classpath"
[INFO] Scanning for projects...
[INFO]
[INFO] ---------------------&lt; net.gunther.cli:json2yaml &gt;----------------------
[INFO] Building json2yaml 0.0.1-SNAPSHOT
[INFO] --------------------------------[ jar ]---------------------------------
[INFO]
[INFO] --- exec-maven-plugin:3.0.0:exec (default-cli) @ json2yaml ---
/home/gunther/_work/java/json2yaml/target/classes:/home/gunther/.m2/repository/javax/json/javax.json-api/1.1/javax.json-api-1.1.jar:/home/gunther/.m2/repository/org/glassfish/javax.json/1.1/javax.json-1.1.jar
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
...</code></pre> 
   </div> 
  </div> 
  <div class="paragraph"> 
   <p>In this case the <code>echo</code> command is executed and displays the classpath passed in as <code>%classpath</code> placeholder. The exec plugin substitutes this placeholder when starting the application.</p> 
  </div> 
  <div class="paragraph"> 
   <p>Please note, that the classpath does not contain <em>test</em> dependencies, but only reference artifacts actually required to execute the project’s application.</p> 
  </div> 
  <div class="paragraph"> 
   <p>Another usage of the Maven generated classpath by exec plugin is to actually execute Java applications, eg.:</p> 
  </div> 
  <div class="listingblock"> 
   <div class="content"> 
    <pre class="highlightjs highlight"><code>$ echo '{ "f1": "v1", "f2": "v2" }' | mvn exec:exec -Dexec.executable=java -Dexec.args="-cp %classpath net.gunther.cli.json.PrettyPrinter"
[INFO] Scanning for projects...
[INFO]
[INFO] ---------------------&lt; net.gunther.cli:json2yaml &gt;----------------------
[INFO] Building json2yaml 0.0.1-SNAPSHOT
[INFO] --------------------------------[ jar ]---------------------------------
[INFO]
[INFO] --- exec-maven-plugin:3.0.0:exec (default-cli) @ json2yaml ---
{
    "f1": "v1",
    "f2": "v2"
}
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
...</code></pre> 
   </div> 
  </div> 
  <div class="paragraph"> 
   <p>In this case the <code>java</code> executable is started, which requires the classpath to be given as <code>-cp %classpath</code> option. The placeholder is again substituted by references to the project’s dependencies.</p> 
  </div> 
  <div class="paragraph"> 
   <p>The input string <code>{ "f1": "v1", "f2": "v2" }</code> is piped to the JSON pretty-printer demo application using <code>STDIN</code>, the application writes given JSON in beautified format to <code>STDOUT</code>.</p> 
  </div> 
 </div> 
</div> 
<div class="sect1"> 
 <h2 id="_conclusion">Conclusion</h2> 
 <div class="sectionbody"> 
  <div class="paragraph"> 
   <p>The classpath generated by Maven can be beneficially used in developer’s environments as demonstrated above. The dependencies of the project’s POM are considered and dependencies added to the project are automatically make their way into the generated classpath - really cool.</p> 
  </div> 
  <div class="paragraph"> 
   <p>However, this approach is not suitable for the packaged application, because Maven is typically not available in the target runtime environment of an application. Such use cases are better implemented by packaging as single JAR that contains all dependencies. Alternatively, techniques described in my last Blog <a href="https://guntherrotsch.github.io/blog_2020/executable-java-scripting.html">Executable Scripts with Java</a> or approaches like <code>jbang</code> may be applied - the <code>jbang</code> project is in a very early state, but looks promising.</p> 
  </div> 
 </div> 
</div> 
<div class="sect1"> 
 <h2 id="_links">Links</h2> 
 <div class="sectionbody"> 
  <div class="ulist"> 
   <ul> 
    <li> <p><a href="https://maven.apache.org/">Maven project</a></p> </li> 
    <li> <p><a href="https://www.mojohaus.org/exec-maven-plugin/">Maven Exec Plugin</a></p> </li> 
    <li> <p><a href="https://www.jbang.dev/">jbang.dev project</a></p> </li> 
   </ul> 
  </div> 
 </div> 
</div></p>

  <span>Tags:
			  <span><a style="border: 2px solid; padding: 0.3em" href="../tags/maven.html">maven</a></span>
			  <span><a style="border: 2px solid; padding: 0.3em" href="../tags/classpath.html">classpath</a></span>
			  <span><a style="border: 2px solid; padding: 0.3em" href="../tags/maven-plugin.html">maven-plugin</a></span>
			  <span><a style="border: 2px solid; padding: 0.3em" href="../tags/java.html">java</a></span>
	</span>

	<hr />

		</div>
		<div id="push"></div>
    </div>

    <div id="footer">
      <div class="container">
        <p class="muted credit">&copy; 2021 Gunther Rotsch | <a href= "/contact.html">Contact and Legal Notice</a>
        <!--| Mixed with <a href="http://getbootstrap.com/">Bootstrap v3.1.1</a> | Baked with <a href="http://jbake.org">JBake v2.6.1</a></p>
          -->
      </div>
    </div>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../assets/js/jquery-1.11.1.min.js"></script>
    <script src="../assets/js/bootstrap.min.js"></script>
    <script src="../assets/js/prettify.js"></script>

  </body>
</html>
